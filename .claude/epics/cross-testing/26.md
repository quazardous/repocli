---
name: Standardize provider documentation with source of truth approach
status: completed
created: 2025-08-25T14:40:00Z
updated: 2025-08-25T16:30:00Z
last_sync: 2025-08-25T23:03:33+02:00
github: https://github.com/quazardous/repocli/issues/26 
depends_on: []
parallel: true
conflicts_with: []
priority: normal
type: documentation
---

# Task: Standardize provider documentation with source of truth approach

## Description
Transform `lib/providers/github.sh` into the authoritative documentation source that lists ONLY the GitHub CLI commands we actually need to support, with standardized function naming, clear examples, and consistent comment structure. Then ensure `lib/providers/gitlab.sh` follows the same nomenclature for maintainability.

## Problem Statement
Currently:
- **GitHub provider**: Simple passthrough with no documentation value
- **GitLab provider**: Inconsistent function naming and missing command documentation
- **No clear roadmap**: Unknown which commands need to be supported
- **Maintenance issues**: Different naming patterns make code hard to maintain

## Scope - Commands We Actually Need

Based on PM system analysis and core REPOCLI functionality:

### Essential Commands (Priority 1)
```bash
# Authentication
gh auth status              # → rca_auth_status() (same function name in all providers)
gh auth login               # → rca_auth_login() (same function name in all providers)

# Issue Management  
gh issue view #N            # → rca_issue_view() (same function name in all providers)
gh issue create             # → rca_issue_create() (same function name in all providers)
gh issue edit #N            # → rca_issue_edit() (same function name in all providers)
gh issue close #N           # → rca_issue_close() (same function name in all providers)
gh issue reopen #N          # → rca_issue_reopen() (same function name in all providers)
gh issue list               # → rca_issue_list() (same function name in all providers)
gh issue comment #N         # → rca_issue_comment() (same function name in all providers)

# Repository Info
gh repo view                # → rca_repo_view() (same function name in all providers)
```

### PM System Requirements (Priority 2)  
```bash
# Extension System (for sub-issues)
gh extension list           # → rca_extension_list() (same function name in all providers)
gh extension install        # → rca_extension_install() (same function name in all providers)
gh sub-issue create         # → rca_sub_issue_create() (same function name in all providers)

# Advanced Issue Operations
gh issue edit --add-assignee    # Enhanced rca_issue_edit() function
gh issue edit --add-label       # Enhanced rca_issue_edit() function
```

### Nice to Have (Priority 3)
```bash
# Pull Requests (future GitLab MR support)
gh pr list                  # → rca_pr_list() (same function name in all providers)
gh pr view #N               # → rca_pr_view() (same function name in all providers) 
gh pr create                # → rca_pr_create() (same function name in all providers)

# Web Integration
gh repo view --web          # → rca_repo_view() (enhanced with --web support)
gh issue view #N --web      # → rca_issue_view() (enhanced with --web support)
```

## Acceptance Criteria

### GitHub Provider Documentation
- [ ] Transform into comprehensive documentation with function comments (not actual wrappers)
- [ ] Document only commands we actually need (not all 25+ GitHub CLI commands)
- [ ] Standardize function naming in comments: `rca_{command}_{subcommand}()` (repocli action prefix)
- [ ] Include clear usage examples and parameter explanations in comments
- [ ] Maintain direct passthrough functionality (exec gh "$@")

### GitLab Provider Standardization
- [ ] Use IDENTICAL function names as GitHub provider (easier maintenance)
- [ ] Rename existing functions to use rca_ prefix instead of gitlab_ prefix
- [ ] Update gitlab_execute() to call rca_ functions instead of gitlab_ functions
- [ ] Update comments to match GitHub provider format

### Documentation Format
- [ ] Consistent comment structure across providers
- [ ] Function signature documentation in comments only
- [ ] Parameter translation notes (GitHub → GitLab) in comments
- [ ] Usage examples for each function in comments
- [ ] Implementation status tracking

### Implementation Constraint
- [ ] GitHub provider: Implement --repocli-can-handle pattern for consistency with GitLab provider
- [ ] GitLab provider: Rename functions from gitlab_* to rca_* but keep all existing logic
- [ ] Both providers use identical routing logic with --repocli-can-handle self-registration
- [ ] GitHub provider must NOT reference GitLab - it's pure GitHub CLI documentation
- [ ] GitLab provider should reference GitHub as the standard being implemented
- [ ] Use KISS approach: --repocli-can-handle self-registration pattern
- [ ] Each rca_ function declares what patterns it handles via --repocli-can-handle "$@"
- [ ] Router uses first-match-wins: first function that returns 0 for --repocli-can-handle gets the call
- [ ] Include pedagogical examples using bash regex and glob patterns in GitHub provider
- [ ] No static configuration arrays or complex switch cases needed
- [ ] Automatic discovery of rca_ functions using declare -F | grep "rca_"

## Implementation Strategy

### 1. GitHub Provider Source of Truth
```bash
# lib/providers/github.sh - Transform to documentation source

# =============================================================================
# GITHUB PROVIDER - SOURCE OF TRUTH DOCUMENTATION
# =============================================================================
# This file serves as the authoritative reference for all GitHub CLI commands
# that REPOCLI supports. Each function documents the expected behavior, 
# parameters, and examples that other providers should implement.

#
# AUTHENTICATION COMMANDS
#
# gh auth status - Check authentication status
# Usage: repocli auth status
# Returns: Authentication status and current user info
rca_auth_status() {
    # GitHub: Direct passthrough to gh auth status
    gh auth status "$@"
}

# gh auth login - Interactive login to GitHub
# Usage: repocli auth login [--hostname HOST] [--web]
# Returns: Success/failure of authentication
rca_auth_login() {
    # GitHub: Direct passthrough to gh auth login
    gh auth login "$@"
}

#
# ISSUE MANAGEMENT COMMANDS  
#
# gh issue view - Display issue details
# Usage: repocli issue view NUMBER [--json FIELDS] [-q QUERY] [--web]
# Parameters:
#   NUMBER: Issue number to view
#   --json: Return JSON output with specified fields
#   -q: jq query to apply to JSON output
#   --web: Open issue in web browser
# Returns: Issue details in text or JSON format
rca_issue_view() {
    # GitHub: Direct passthrough - gh handles all parameters natively
    gh issue view "$@"
}

# gh issue create - Create new issue
# Usage: repocli issue create [--title TITLE] [--body BODY] [--body-file FILE] [--label LABELS]
# Parameters:
#   --title: Issue title
#   --body: Issue description
#   --body-file: File containing issue description  
#   --label: Comma-separated list of labels
# Returns: URL of created issue, or JSON with --json flag
rca_issue_create() {
    # GitHub: Direct passthrough - supports all native parameters
    gh issue create "$@"
}

# [Continue for all essential commands...]
```

### 2. GitLab Provider with --repocli-can-handle Self-Registration
```bash
# lib/providers/gitlab.sh - KISS approach with self-registering functions

# Simple router with first-match-wins pattern matching
gitlab_execute() {
    debug_log "GitLab provider executing with gh compatibility: $*"
    
    # Check if glab CLI is available
    if ! check_cli_tool "glab"; then
        exit 1
    fi
    
    # Set hostname for custom GitLab instances
    if [[ -n "$REPOCLI_INSTANCE" && "$REPOCLI_INSTANCE" != "https://gitlab.com" ]]; then
        local hostname=$(echo "$REPOCLI_INSTANCE" | sed 's|^https\?://||' | sed 's|/.*$||')
        export GITLAB_HOST="$hostname"
        debug_log "Using GitLab instance: $hostname"
    fi
    
    # Query each rca_ function to see if it can handle this command
    # First function that says "yes" wins
    for func in $(declare -F | grep "rca_" | cut -d' ' -f3); do
        if "$func" --repocli-can-handle "$@" 2>/dev/null; then
            debug_log "GitLab: Routing to $func for command: $*"
            "$func" "$@"
            return
        fi
    done
    
    # No rca_ function claimed it, pass through to glab
    debug_log "Passing through unknown command to glab: $*"
    exec glab "$@"
}

#
# RCA FUNCTION IMPLEMENTATIONS WITH SELF-REGISTRATION
#
# Implementation of GitHub CLI rca_auth_status() for GitLab
rca_auth_status() {
    # Handle --repocli-can-handle query
    if [[ "$1" == "--repocli-can-handle" ]]; then
        shift
        [[ "$1 $2" == "auth status" ]] && return 0 || return 1
    fi
    
    debug_log "GitLab: Checking authentication status"
    exec glab auth status
}

# Implementation of GitHub CLI rca_auth_login() for GitLab
rca_auth_login() {
    # Handle --repocli-can-handle query  
    if [[ "$1" == "--repocli-can-handle" ]]; then
        shift
        [[ "$1 $2" == "auth login" ]] && return 0 || return 1
    fi
    
    debug_log "GitLab: Starting authentication login"
    exec glab auth login "$@"
}

# Implementation of GitHub CLI rca_issue_view() for GitLab
rca_issue_view() {
    # Handle --repocli-can-handle query
    if [[ "$1" == "--repocli-can-handle" ]]; then
        shift
        [[ "$1 $2" == "issue view" ]] && return 0 || return 1
    fi
    
    local issue_num="$1"
    shift
    debug_log "GitLab: Viewing issue $issue_num"
    
    # [Current implementation with JSON field mapping and parameter translation]
}

# Implementation of GitHub CLI rca_label_create() for GitLab
rca_label_create() {
    # Handle --repocli-can-handle query
    if [[ "$1" == "--repocli-can-handle" ]]; then
        shift
        [[ "$1 $2" == "label create" ]] && return 0 || return 1
    fi
    
    debug_log "GitLab: Creating label"
    # [Current implementation with parameter translation]
}

# [Continue pattern for all rca_ functions...]
```

### 3. Function Name Migration Strategy
```bash
# Current → Standardized naming migration
gitlab_issue_command()     → Remove (inline into specific functions)  
gitlab_repo_command()      → Remove (inline into specific functions)
gitlab_issue_view()        → Keep (already follows standard)
gitlab_issue_create()      → Keep (already follows standard)
gitlab_issue_edit()        → Keep (already follows standard)
gitlab_issue_comment()     → Keep (already follows standard)
gitlab_issue_close()       → Keep (already follows standard)
gitlab_issue_list()        → Keep (already follows standard)

# Add missing standardized functions
gitlab_auth_status()       → New function
gitlab_auth_login()        → New function  
gitlab_repo_view()         → New function
gitlab_extension_list()    → New function (Task #20a)
gitlab_sub_issue_create()  → New function (Task #20a)
```

## Testing Strategy

### Documentation Consistency Tests
```bash
test_provider_nomenclature() {
    # Verify both providers have matching function names
    local github_functions=$(grep -oE 'github_[a-z_]+\(\)' lib/providers/github.sh | sort)
    local gitlab_functions=$(grep -oE 'gitlab_[a-z_]+\(\)' lib/providers/gitlab.sh | sort)
    
    # Check for naming consistency (same suffixes)
    local github_suffixes=$(echo "$github_functions" | sed 's/github_//' | sort)
    local gitlab_suffixes=$(echo "$gitlab_functions" | sed 's/gitlab_//' | sort) 
    
    diff <(echo "$github_suffixes") <(echo "$gitlab_suffixes") || {
        echo "❌ Provider function nomenclature mismatch"
        return 1
    }
    
    echo "✅ Provider nomenclature consistent"
}

test_documentation_completeness() {
    # Verify all functions have proper documentation comments
    local undocumented=$(grep -B5 -A1 'github_.*() {' lib/providers/github.sh | grep -v '^#' | grep -v '^$' | head -20)
    
    if [[ -n "$undocumented" ]]; then
        echo "❌ Undocumented functions found in GitHub provider"
        return 1
    fi
    
    echo "✅ GitHub provider documentation complete"
}
```

## Benefits of This Approach

### For Developers
- **Clear roadmap**: Know exactly which commands need implementation
- **Consistent patterns**: Same function names across all providers
- **Easy maintenance**: Changes to one provider guide changes to others
- **No over-engineering**: Only implement what we actually need

### For Users  
- **Predictable behavior**: Same command works identically across providers
- **Better error messages**: Consistent error handling patterns
- **Feature parity**: All providers support the same core functionality

### For Project
- **Reduced scope**: Focus on 12 essential commands vs 25+ complete GitHub CLI
- **Faster development**: Clear implementation targets
- **Better testing**: Test same function signatures across providers

## Dependencies
- Understanding of current GitLab provider implementation
- Analysis of PM system requirements (from Task #20)
- Access to both GitHub and GitLab CLI documentation

## Definition of Done
- [ ] GitHub provider serves as complete documentation source
- [ ] All function names standardized across providers  
- [ ] Only essential commands documented (not comprehensive GitHub CLI coverage)
- [ ] Comments explain parameter translation between providers
- [ ] GitLab provider follows identical nomenclature
- [ ] Function stubs exist for planned features (sub-issue, advanced JSON, etc.)
- [ ] Migration path documented for existing function names

## Effort Estimate
- Size: M
- Hours: 8-12 hours
- Focus on pragmatic documentation, not comprehensive coverage

## Usage Examples

```bash
# After standardization, clear patterns for extending providers

# 1. Add new command to GitHub provider (documentation)
github_issue_lock() {
    # gh issue lock - Lock issue to prevent further comments
    # Usage: repocli issue lock NUMBER [--reason REASON]
    # GitLab equivalent: glab issue update --lock-discussion
    gh issue lock "$@"
}

# 2. Implement in GitLab provider (translation)
gitlab_issue_lock() {
    local issue="$1"; shift
    local reason=""
    
    # Parse GitHub-style arguments
    while [[ $# -gt 0 ]]; do
        case "$1" in
            "--reason") reason="$2"; shift 2 ;;
            *) shift ;;
        esac
    done
    
    # Translate to GitLab command
    glab issue update "$issue" --lock-discussion
}

# 3. Both providers now support: repocli issue lock #123 --reason spam
```

Cette approche pragmatique nous donne une documentation claire et maintenable sans sur-ingénierie.