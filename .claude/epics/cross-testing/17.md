---
name: Add support for tags/labels in issue creation and listing commands
status: open
created: 2025-08-25T14:05:00Z
updated: 
github: 
depends_on: [16]
parallel: true
conflicts_with: []
priority: normal
type: feature
---

# Task: Add support for tags/labels in issue creation and listing commands

## Description
Implement comprehensive support for labels/tags in REPOCLI issue commands with proper translation between GitHub CLI (`gh`) and GitLab CLI (`glab`). This includes handling the terminology differences (GitHub: "labels", GitLab: "labels"), parameter mapping, and output format consistency.

## Problem Analysis

**GitHub vs GitLab Label Differences:**

| Aspect | GitHub (`gh`) | GitLab (`glab`) |
|--------|---------------|-----------------|
| **Terminology** | "labels" | "labels" (same) |
| **Creation** | `gh issue create --label bug,feature` | `glab issue create --label bug,feature` |
| **Listing** | `gh issue list --label bug` | `glab issue list --label bug` |
| **Multiple labels** | `--label label1,label2` | `--label label1 --label label2` OR `--label label1,label2` |
| **JSON output** | `"labels": [{"name": "bug"}]` | `"labels": ["bug"]` (simpler format) |
| **Label colors** | Included in JSON | Included in JSON |
| **Search** | `--label` filter | `--label` filter |

## Acceptance Criteria

### Core Functionality
- [ ] Issue creation with labels: `repocli issue create --title "Test" --label bug,enhancement`
- [ ] Issue listing with label filter: `repocli issue list --label bug`
- [ ] Multiple label support: `--label bug --label enhancement` and `--label bug,enhancement`
- [ ] Label output consistency in JSON format
- [ ] Label color preservation across providers

### Parameter Translation (GitLab Provider)
- [ ] Map GitHub-style `--label` to GitLab-style `--label`
- [ ] Handle comma-separated labels correctly
- [ ] Support both single and multiple `--label` flags
- [ ] Preserve label order when possible

### JSON Output Standardization  
- [ ] Normalize GitLab simple `["label1", "label2"]` to GitHub format `[{"name": "label1"}]`
- [ ] Preserve label colors in standardized format
- [ ] Handle empty labels array consistently

### Cross-Testing Integration
- [ ] Add label-specific tests to cross-testing framework
- [ ] Validate label creation/listing equivalence between providers
- [ ] Test edge cases (special characters, Unicode, long labels)

## Technical Details

### Implementation Locations
- **GitLab Provider** (`lib/providers/gitlab.sh`):
  - `gitlab_issue_create()` - add label parameter handling
  - `gitlab_issue_list()` - add label filtering
  - JSON transformation for label output consistency

- **Cross-Testing** (`tests/cross-testing/lib/`):
  - Add label-specific test cases
  - Compare JSON label output between GitHub and GitLab

### Parameter Mapping Strategy

**GitHub ‚Üí GitLab Translation:**
```bash
# Handle both formats
--label bug,enhancement     # Single flag with comma-separated
--label bug --label enhancement  # Multiple flags

# GitLab accepts both, but prefer comma-separated for consistency
glab issue create --label bug,enhancement
```

**JSON Output Normalization:**
```bash
# GitLab format: ["bug", "enhancement"]  
# Normalize to: [{"name": "bug"}, {"name": "enhancement"}]

# Function: normalize_labels_json()
normalize_labels_json() {
    local json="$1"
    echo "$json" | jq '.labels = (.labels // [] | map(if type == "string" then {"name": .} else . end))'
}
```

## Implementation Requirements

### 1. GitLab Provider Updates

```bash
# In lib/providers/gitlab.sh
gitlab_issue_create() {
    # ... existing code ...
    
    # Handle label parameters
    local labels=""
    while [[ $# -gt 0 ]]; do
        case "$1" in
            "--label")
                if [[ -n "$labels" ]]; then
                    labels="$labels,$2"
                else
                    labels="$2"
                fi
                shift 2
                ;;
            # ... other parameters ...
        esac
    done
    
    # Add to glab command
    [[ -n "$labels" ]] && glab_args+=(--label "$labels")
}

gitlab_issue_list() {
    # ... existing code ...
    
    # Handle label filter
    local label_filter=""
    while [[ $# -gt 0 ]]; do
        case "$1" in
            "--label")
                label_filter="$2"
                shift 2
                ;;
            # ... other parameters ...
        esac
    done
    
    # Add to glab command  
    [[ -n "$label_filter" ]] && glab_args+=(--label "$label_filter")
}
```

### 2. JSON Output Normalization

```bash
# Function to normalize label format
normalize_gitlab_labels() {
    local output="$1"
    echo "$output" | jq '
        if type == "array" then
            map(.labels = (.labels // [] | map(
                if type == "string" then {"name": .} else . end
            )))
        else
            .labels = (.labels // [] | map(
                if type == "string" then {"name": .} else . end
            ))
        end
    '
}
```

### 3. Cross-Testing Integration

```bash
# New test: tests/cross-testing/test-labels.sh
test_issue_create_with_labels() {
    local github_output github_labels
    local gitlab_output gitlab_labels
    
    # Test with multiple labels
    github_output=$(gh issue create --title "Label Test" --label bug,enhancement --json labels)
    gitlab_output=$(repocli issue create --title "Label Test" --label bug,enhancement --json labels)
    
    # Compare normalized outputs
    github_labels=$(echo "$github_output" | jq '.labels')
    gitlab_labels=$(echo "$gitlab_output" | normalize_gitlab_labels | jq '.labels')
    
    # Validate equivalence
    compare_json_semantically "$github_labels" "$gitlab_labels"
}
```

## Edge Cases to Handle

### 1. Special Characters in Labels
- Labels with spaces: `"needs review"`
- Unicode labels: `"üêõ bug"`  
- Special chars: `"high-priority!"`

### 2. Label Limits
- Maximum label length per provider
- Maximum number of labels per issue
- Reserved/system labels

### 3. Label Colors
- Preserve color information when available
- Handle missing colors gracefully
- Consistent color format across providers

## Dependencies
- [ ] Task 16: Wrapper fixes must be complete (proper option handling)
- [ ] Understanding of GitHub vs GitLab label APIs
- [ ] Access to test repositories for label testing

## Effort Estimate
- Size: M
- Hours: 8-12 hours
- Parallel: true (extends existing functionality)

## Definition of Done
- [ ] All label operations work correctly through REPOCLI
- [ ] GitLab provider properly translates label parameters
- [ ] JSON output consistently formatted across providers
- [ ] Cross-testing validates label functionality
- [ ] Edge cases handled gracefully
- [ ] Documentation updated with label examples

## Usage Examples

```bash
# Create issue with labels
repocli issue create --title "Bug report" --label bug,urgent --body "Description"

# List issues by label
repocli issue list --label bug

# List issues with multiple label filters
repocli issue list --label bug --label urgent

# JSON output with labels
repocli issue list --json labels,title,number

# Cross-testing validation
./tests/cross-testing/run-cross-tests.sh labels
```

## Testing Strategy

1. **Unit Tests**: Individual label operations
2. **Integration Tests**: Full issue workflow with labels
3. **Cross-Provider Tests**: GitHub vs GitLab equivalence
4. **Edge Case Tests**: Special characters, limits, colors
5. **Performance Tests**: Large numbers of labels

This task significantly enhances REPOCLI's completeness for issue management workflows that rely heavily on labeling systems.