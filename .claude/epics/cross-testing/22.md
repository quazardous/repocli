---
name: Add comprehensive coverage of GitHub CLI features used by PM system
status: open
created: 2025-08-25T14:20:00Z
updated: 
last_sync: 2025-08-25T14:14:47Z
github: https://github.com/quazardous/repocli/issues/22 
depends_on: [16]
parallel: true
conflicts_with: []
priority: high
type: feature
---

# Task: Add comprehensive coverage of GitHub CLI features used by PM system

## Description
Ensure REPOCLI wrapper provides complete coverage of all GitHub CLI features that our own project management system (`.claude/scripts/pm` and `.claude/commands/pm`) depends on. This critical task identifies which rca_ action wrappers are actually needed to support PM sub-commands and implements only the essential functionality required by the PM workflow.

## Problem Analysis

### Step 1: PM System Audit Required

‚ö†Ô∏è **CRITICAL FIRST STEP**: Before implementing any rca_ wrappers, we must audit the PM system to identify exactly which GitHub CLI commands are actually used by PM sub-commands.

**Required Analysis**:
1. **Inventory all `gh` commands** used in `.claude/scripts/pm/*` and `.claude/commands/pm/*`
2. **Map PM sub-commands** to their GitHub CLI dependencies
3. **Identify minimum viable rca_ functions** needed for PM workflow
4. **Prioritize by PM usage frequency** and criticality

### Step 2: Known Required Functions (De Facto Needed)

**Confirmed essential functions that PM system requires**:

**1. Label Management (REQUIRED)**
- **Issue**: PM system needs `gh label create` functionality  
- **Impact**: Epic and issue management broken without label creation
- **rca_ function needed**: `rca_label_create` (mandatory)

**2. Repository Status/Ping (REQUIRED)**
- **Issue**: PM system needs repository connectivity/status checks
- **Impact**: PM workflows fail without repository ping/status
- **rca_ function needed**: `rca_repo_ping` or similar status checking (mandatory)

### Step 3: Potential Additional Gaps (TO BE VERIFIED)

**Based on initial analysis, potential additional gaps**:

**3. Extension Command Framework**
- **Issue**: PM system may use `gh extension` and `gh sub-issue create`
- **Need to verify**: Which PM commands actually depend on extensions?
- **rca_ function needed**: Only if PM system requires it

**4. Advanced JSON Query Support**  
- **Issue**: Complex `-q .field` patterns not properly translated
- **Need to verify**: Which specific JSON queries are used by PM?
- **rca_ function needed**: Enhanced query handling in existing rca_ functions

**5. Assignee Management**
- **Issue**: `--add-assignee @me`, `--remove-assignee` not translated
- **Need to verify**: Do PM workflows use assignee commands?
- **rca_ function needed**: Assignee parameters in rca_issue_edit

**6. Sub-Issue Relationships**
- **Issue**: `gh sub-issue create --parent X` has no GitLab equivalent
- **Need to verify**: Does PM system create parent/child relationships?
- **rca_ function needed**: rca_sub_issue_create (if required)

## PM System Usage Analysis

‚ö†Ô∏è **AUDIT REQUIRED**: The following analysis is preliminary. **Task #22 MUST begin with a comprehensive audit** of PM system files to identify exact GitHub CLI usage patterns.

### Required PM System Audit Process

**Phase 1: Command Discovery**
```bash
# Find all GitHub CLI usage in PM system
find .claude/scripts/pm/ .claude/commands/pm/ -name "*.sh" -o -name "*.md" | xargs grep -n "gh " > pm-gh-usage.txt

# Analyze command patterns
grep -E "gh (auth|issue|repo|pr|extension|sub-issue)" pm-gh-usage.txt | sort | uniq -c
```

**Phase 2: PM Command Mapping**
```bash
# For each PM sub-command, identify GitHub CLI dependencies
/pm:epic-sync     ‚Üí uses: gh ??? (TBD)
/pm:issue-create  ‚Üí uses: gh ??? (TBD)  
/pm:issue-start   ‚Üí uses: gh ??? (TBD)
/pm:issue-close   ‚Üí uses: gh ??? (TBD)
# ... complete mapping required
```

**Phase 3: Required rca_ Function List**
Combine confirmed requirements with audit results to determine final implementation list:

```bash
# MANDATORY (confirmed requirements):
rca_label_create    ‚ùó (REQUIRED - PM needs label creation)
rca_repo_ping       ‚ùó (REQUIRED - PM needs repository status/connectivity)

# EXISTING (already implemented):
rca_auth_status     ‚úÖ (already exists)
rca_issue_view      ‚úÖ (already exists) 
rca_issue_create    ‚úÖ (already exists)

# TO BE DETERMINED BY AUDIT:
rca_issue_edit      ‚ö†Ô∏è (needs assignee support?)
rca_extension_list  ‚ùì (if PM uses extensions)
rca_sub_issue_*     ‚ùì (if PM uses sub-issues)
# ... additional functions based on actual PM usage
```

### Preliminary Analysis (TO BE VERIFIED)

**Authentication Commands (‚úÖ Likely Covered)**
```bash
gh auth status          # ‚Üí rca_auth_status (verify PM usage)
gh auth login           # ‚Üí rca_auth_login (verify PM usage)
```

**Issue Commands (‚ö†Ô∏è Verify Coverage)**
```bash
# Verify which of these PM actually uses:
gh issue view --json ...     # ‚Üí rca_issue_view 
gh issue create --title ...  # ‚Üí rca_issue_create
gh issue edit --assignee ... # ‚Üí rca_issue_edit (assignee support?)
gh issue close --comment ... # ‚Üí rca_issue_close
```

**Extension Commands (‚ùì Verify If Used)**
```bash
# Verify if PM system actually uses:
gh extension list
gh extension install yahsan2/gh-sub-issue  
gh sub-issue create --parent N --title "X"
```

**Repository Commands (‚úÖ REQUIRED)**
```bash
# CONFIRMED: PM system needs repository status/connectivity
gh repo ping                # ‚Üí rca_repo_ping (REQUIRED for PM)
gh repo view --json ...     # ‚Üí rca_repo_view (verify specific usage patterns)
```

**Label Commands (‚úÖ REQUIRED)**
```bash
# CONFIRMED: PM system needs label management  
gh label create             # ‚Üí rca_label_create (REQUIRED for PM)
gh label list               # ‚Üí rca_label_list (verify if PM needs this)
```

## Acceptance Criteria

### Phase 1: PM System Audit (MANDATORY FIRST STEP)
- [ ] **Complete audit of PM system GitHub CLI usage** using grep/find commands
- [ ] **Create comprehensive mapping** of PM sub-commands to their GitHub CLI dependencies  
- [ ] **Document exact command patterns** used by PM system (parameters, JSON queries, etc.)
- [ ] **Prioritize rca_ functions** by PM usage frequency and criticality
- [ ] **Create minimal viable function list** - only implement what PM actually needs

### Phase 2: Essential rca_ Function Implementation

**MANDATORY functions (confirmed PM requirements):**
- [ ] **rca_label_create**: Label creation functionality for PM epic/issue management  
- [ ] **rca_repo_ping**: Repository connectivity/status checking for PM workflows

**CONDITIONAL functions (based on audit results):**
- [ ] **rca_extension_***: Only if PM system uses `gh extension` commands
- [ ] **rca_sub_issue_***: Only if PM system uses `gh sub-issue` commands  
- [ ] **Enhanced rca_issue_edit**: Only if PM uses assignee/label editing
- [ ] **Enhanced JSON queries**: Only implement specific `-q` patterns PM actually uses
- [ ] **Additional rca_repo_***: Only if PM system uses other `gh repo` commands beyond ping

### Phase 3: PM Workflow Validation
- [ ] **Test each PM sub-command** with GitLab provider using test repository
- [ ] **Verify end-to-end PM workflows** work correctly (epic-sync, issue management)
- [ ] **Document any PM limitations** when using GitLab provider
- [ ] **Create PM-specific cross-testing suite** to validate wrapper coverage

## Implementation Requirements

‚ö†Ô∏è **IMPORTANT**: The following implementation examples are CONDITIONAL. They should only be implemented if the PM system audit (Phase 1) reveals that PM actually uses these commands.

### 1. GitHub Provider Documentation (PRIMARY DELIVERABLE)

**Primary Deliverable**: Pseudo wrapper functions documented in `lib/providers/github.sh` with PM usage examples:

```bash
# In lib/providers/github.sh - DOCUMENTATION for PM-required functions

# Label Management (REQUIRED for PM)
rca_label_create() {
    [[ "$1" == "--repocli-can-handle" ]] && { echo "label create"; return 0; }
    return 0  # Documentation only - actual execution via exec gh "$@"
    
    # DOCUMENTATION: Label creation for PM system
    # Used by PM commands: /pm:epic-create, /pm:issue-create
    # 
    # GitHub CLI usage patterns:
    # gh label create "bug" --color red --description "Bug reports"
    # gh label create "enhancement" --color blue 
    # gh label create "in-progress"  # Simple name-only creation
    #
    # Parameter examples:
    # --name "label-name"     # Label name (can be positional)
    # --color "ff0000"        # Hex color code
    # --description "text"    # Label description
    #
    # PM workflow integration:
    # - Epic creation: Creates epic-specific labels
    # - Issue management: Creates status labels (in-progress, completed)
    # - Task categorization: Creates type labels (bug, feature, task)
}

rca_repo_ping() {
    [[ "$1" == "--repocli-can-handle" ]] && { echo "repo ping"; return 0; }
    return 0  # Documentation only - actual execution via exec gh "$@"
    
    # DOCUMENTATION: Repository connectivity check for PM system
    # Used by PM commands: /pm:epic-sync, /pm:status, /pm:init
    #
    # GitHub CLI usage patterns:
    # gh repo view --json name    # Basic connectivity test
    # gh api repos/owner/repo     # Direct API connectivity check
    #
    # PM workflow integration:
    # - Epic sync: Verifies repository access before sync operations
    # - Status checks: Validates GitHub connection for PM operations
    # - Initialization: Ensures repository is accessible during PM setup
    #
    # Expected outputs:
    # - Success: Repository information or simple success message
    # - Failure: Connection error, authentication required, or repo not found
}
```

### 2. GitLab Provider Implementation (SECONDARY DELIVERABLE)

```bash
# In lib/providers/gitlab.sh - ACTUAL implementation
rca_label_create() {
    [[ "$1" == "--repocli-can-handle" ]] && { echo "label create"; return 0; }
    
    local name="" color="" description=""
    
    # Parse label creation arguments  
    while [[ $# -gt 0 ]]; do
        case "$1" in
            "--name") name="$2"; shift 2 ;;
            "--color") color="$2"; shift 2 ;;
            "--description") description="$2"; shift 2 ;;
            *) name="$1"; shift ;;  # Handle positional name argument
        esac
    done
    
    [[ -z "$name" ]] && { echo "Error: label name required" >&2; return 1; }
    
    # Create label with GitLab
    local glab_args=(--name "$name")
    [[ -n "$color" ]] && glab_args+=(--color "$color")
    [[ -n "$description" ]] && glab_args+=(--description "$description")
    
    glab label create "${glab_args[@]}"
}

rca_repo_ping() {
    [[ "$1" == "--repocli-can-handle" ]] && { echo "repo ping"; return 0; }
    
    # Check repository connectivity using GitLab API
    if glab api projects/"$GITLAB_PROJECT_PATH" >/dev/null 2>&1; then
        echo "Repository is accessible"
        return 0
    else
        echo "Repository is not accessible" >&2
        return 1
    fi
}
```

### 3. Additional PM Functions (CONDITIONAL - BASED ON AUDIT)

**GitHub Provider Documentation Pattern** for additional functions discovered in PM audit:

```bash
# EXAMPLE: Extension commands (only if PM audit shows usage)
# In lib/providers/github.sh - DOCUMENTATION template

rca_extension_list() {
    [[ "$1" == "--repocli-can-handle" ]] && { echo "extension list"; return 0; }
    return 0  # Documentation only - actual execution via exec gh "$@"
    
    # DOCUMENTATION: Extension management for PM system
    # Used by PM commands: [TO BE DETERMINED BY AUDIT]
    #
    # GitHub CLI usage patterns:
    # gh extension list                    # List installed extensions
    # gh extension install user/repo      # Install extension
    #
    # PM workflow integration:
    # [TO BE DETERMINED BY PM AUDIT RESULTS]
}

# EXAMPLE: Sub-issue commands (only if PM audit shows usage)
rca_sub_issue_create() {
    [[ "$1" == "--repocli-can-handle" ]] && { echo "sub-issue create"; return 0; }
    return 0  # Documentation only - actual execution via exec gh "$@"
    
    # DOCUMENTATION: Sub-issue creation for PM system
    # Used by PM commands: [TO BE DETERMINED BY AUDIT]
    #
    # GitHub CLI usage patterns (via extension):
    # gh sub-issue create --parent 123 --title "Task" --body-file desc.md
    #
    # PM workflow integration:
    # [TO BE DETERMINED BY PM AUDIT RESULTS]
}
```

## Primary Deliverable (CRITICAL)

**üéØ PRIMARY DELIVERABLE**: Add PM system error handling documentation to `lib/providers/github.sh`

**MUST BE COMPLETED:**
1. **PM Error Handling Patterns Section** - Add comprehensive section documenting:
   - All PM command patterns that require specific error behavior
   - Exit codes that PM depends on for workflow control
   - Output parsing patterns PM uses (grep, jq queries, etc.)
   - Silent operation requirements (`&> /dev/null` patterns)

2. **rca_ Function Documentation** - Update existing rca_ functions with:
   - PM command usage examples (`Used by PM commands: /pm:epic-sync, /pm:init`)
   - Expected error outputs for PM compatibility
   - **Error detection specifications** for each function
   - Debug mode behavior specifications

3. **Error Detection Documentation** - Each rca_ function MUST include PM error detection specification:
   - `Error detection: none` - PM doesn't check for errors from this command
   - `Error detection: status only` - PM only checks exit code (if command failed)
   - `Error detection: stdout catching "specific message"` - PM parses stdout for specific error text
   - `Error detection: stderr catching "error pattern"` - PM monitors stderr for error patterns
   - `Error detection: not yet analyzed` - PM's error handling pattern has not been analyzed yet
   - `Error detection: unknown` - Analyzer failed to understand PM's error handling pattern
   
   **IMPORTANT**: This documents how PM system detects errors EXTERNALLY from repocli commands, not internal function behavior.

**CONCRETE OUTPUT**: Modified `lib/providers/github.sh` with PM compatibility documentation

## Secondary Deliverables
- PM system audit summary 
- GitLab provider implementation guidance
- Error mapping requirements for other providers

## Cross-Testing Integration

### PM-Specific Test Cases

```bash
# Test PM-required functions
test_pm_label_management() {
    if [[ "$gitlab_test_mode" != "read_only" ]]; then
        # Test label creation (required for PM)
        local label_result=$(repocli label create "pm-test-label" --color red --description "PM test label")
        assert_success "$label_result" "PM label creation should work"
        
        echo "‚úÖ PM label management working"
    fi
}

test_pm_repo_connectivity() {
    # Test repository ping (required for PM)
    local ping_result=$(repocli repo ping)
    assert_success "$ping_result" "PM repo ping should work"
    
    echo "‚úÖ PM repository connectivity working"
}

# Test full PM workflow integration
test_pm_workflow_integration() {
    echo "üîß Testing PM command integration with GitLab provider..."
    
    # Test PM commands that depend on REPOCLI wrapper
    # [SPECIFIC TESTS TO BE DETERMINED BASED ON PM AUDIT RESULTS]
    
    echo "‚úÖ PM workflow integration verified"
}
```

## Dependencies
- [ ] Task 18: --repocli-config option and wrapper fixes (completed)
- [ ] **PM system audit completion** (Phase 1 - mandatory first step)
- [ ] Understanding of GitLab API for features PM actually uses
- [ ] Test GitLab repository with appropriate permissions for PM workflow testing

## Effort Estimate
- **Phase 1 (Audit)**: 4-6 hours
- **Phase 2 (Implementation)**: Variable based on audit results (8-20 hours)
- **Phase 3 (Testing)**: 4-8 hours
- **Total**: 16-34 hours (depends on PM system complexity)
- **Priority**: High (blocks PM system GitLab compatibility)

## Definition of Done

### Phase 1: Audit Complete
- [ ] **PM system audit completed** with comprehensive GitHub CLI command inventory
- [ ] **PM command mapping documented** showing exact dependencies
- [ ] **Minimal rca_ function list created** based on actual PM requirements
- [ ] **Implementation priority established** based on PM usage frequency

### Phase 2: Implementation Complete (ONLY FOR FUNCTIONS PM ACTUALLY NEEDS)
- [ ] **GitHub provider documentation updated** with pseudo wrapper functions for PM-used patterns
- [ ] **PM command usage documented** in GitHub provider showing which PM commands use each function
- [ ] **Usage examples included** in GitHub provider pseudo functions (with `return 0`)
- [ ] **GitLab provider enhanced** with only PM-required functionality

### Phase 3: PM Integration Validated
- [ ] **All PM sub-commands tested** with GitLab provider
- [ ] **End-to-end PM workflows verified** (epic-sync, issue management)
- [ ] **PM limitations documented** when using GitLab provider
- [ ] **Cross-testing includes PM-specific test suite**

‚ö†Ô∏è **SUCCESS CRITERIA**: PM system works completely on GitLab provider with minimal necessary wrapper functions - no over-engineering.

## Critical Impact Statement

**This task is essential for REPOCLI adoption**. Our own PM system is the primary user of GitHub CLI features - if REPOCLI can't handle our own workflows, it can't be trusted for external users. This represents a "eat your own dog food" validation of the wrapper's completeness.

**However, the key is to implement ONLY what PM actually needs** - avoid over-engineering by creating wrapper functions for commands that PM doesn't use.

## Usage Examples (CONDITIONAL - BASED ON PM AUDIT RESULTS)

```bash
# Only implement examples that PM audit shows are actually used:

# IF PM uses extensions:
repocli extension list                    # Graceful handling (if PM needs it)

# IF PM uses sub-issues:
repocli sub-issue create --parent 123 --title "Task"  # GitLab simulation (if PM needs it)

# IF PM uses assignee management:
repocli issue edit 456 --add-assignee @me            # Assignee support (if PM needs it)

# IF PM uses specific JSON queries:
repocli issue view 789 --json number -q .number      # Complex JSON queries (if PM needs it)

# MANDATORY: PM commands must work (including required label/repo functions)
repocli label create "bug" --color red             # REQUIRED for PM
repocli repo ping                                  # REQUIRED for PM
/pm:epic-sync cross-testing                       # Must work on GitLab
/pm:issue-create "New task"                        # Must work on GitLab  
/pm:issue-start 123                                # Must work on GitLab
```

This task ensures our wrapper handles sophisticated automation workflows with **minimal necessary implementation** - no feature bloat.