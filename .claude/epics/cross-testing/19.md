---
name: Add support for tags/labels in issue creation and listing commands
status: open
created: 2025-08-25T14:05:00Z
updated: 
last_sync: 2025-08-25T14:14:47Z
github: https://github.com/quazardous/repocli/issues/19 
depends_on: [16]
parallel: true
conflicts_with: []
priority: normal
type: feature
---

# Task: Add support for tags/labels in issue creation and listing commands

## Description
Implement comprehensive support for labels/tags in REPOCLI issue commands with proper translation between GitHub CLI (`gh`) and GitLab CLI (`glab`). This includes handling the terminology differences (GitHub: "labels", GitLab: "labels"), parameter mapping, and output format consistency.

## Problem Analysis

**Scope Limitation**: This task focuses ONLY on essential label operations:
1. **Issue creation with labels** (`--label` parameter in `repocli issue create`)
2. **Issue listing with label filter** (`--label` filter in `repocli issue list`)

‚ö†Ô∏è **IMPORTANT**: We will NOT implement standalone label management commands (create, delete, list labels) as they are not core to the issue workflow and label creation is mandatory in most providers.

**GitHub vs GitLab Label Differences:**

| Aspect | GitHub (`gh`) | GitLab (`glab`) |
|--------|---------------|-----------------|
| **Terminology** | "labels" | "labels" (same) |
| **Creation** | `gh issue create --label bug,feature` | `glab issue create --label bug,feature` |
| **Listing** | `gh issue list --label bug` | `glab issue list --label bug` |
| **Multiple labels** | `--label label1,label2` | `--label label1 --label label2` OR `--label label1,label2` |
| **JSON output** | `"labels": [{"name": "bug"}]` | `"labels": ["bug"]` (simpler format) |

## Acceptance Criteria

### Core Functionality (ONLY)
- [ ] Issue creation with labels: `repocli issue create --title "Test" --label bug,enhancement`
- [ ] Issue listing with label filter: `repocli issue list --label bug`
- [ ] Multiple label support: `--label bug --label enhancement` and `--label bug,enhancement`
- [ ] Label output consistency in JSON format

### Parameter Translation (GitLab Provider)
- [ ] Map GitHub-style `--label` to GitLab-style `--label` in issue creation
- [ ] Handle comma-separated labels correctly in issue creation
- [ ] Support label filtering in issue listing
- [ ] Handle multiple `--label` flags in issue listing

### JSON Output Standardization  
- [ ] Normalize GitLab simple `["label1", "label2"]` to GitHub format `[{"name": "label1"}]`
- [ ] Handle empty labels array consistently

### Cross-Testing Integration
- [ ] Add label-specific tests for issue creation with labels
- [ ] Add label-specific tests for issue listing with label filter
- [ ] Validate label functionality equivalence between providers

## Technical Details

### Implementation Locations
- **GitLab Provider** (`lib/providers/gitlab.sh`):
  - `rca_issue_create()` - add label parameter handling
  - `rca_issue_list()` - add label filtering
  - JSON transformation for label output consistency

- **GitHub Provider** (`lib/providers/github.sh`):
  - `rca_issue_create()` - documentation for label parameter (return 0)
  - `rca_issue_list()` - documentation for label filtering (return 0)

- **Cross-Testing** (`tests/cross-testing/lib/`):
  - Add label-specific test cases for issue creation and listing only
  - Compare JSON label output between GitHub and GitLab

### Parameter Mapping Strategy

**GitHub ‚Üí GitLab Translation:**
```bash
# Handle both formats
--label bug,enhancement     # Single flag with comma-separated
--label bug --label enhancement  # Multiple flags

# GitLab accepts both, but prefer comma-separated for consistency
glab issue create --label bug,enhancement
```

**JSON Output Normalization:**
```bash
# GitLab format: ["bug", "enhancement"]  
# Normalize to: [{"name": "bug"}, {"name": "enhancement"}]

# Function: normalize_labels_json()
normalize_labels_json() {
    local json="$1"
    echo "$json" | jq '.labels = (.labels // [] | map(if type == "string" then {"name": .} else . end))'
}
```

## Implementation Requirements

### 1. GitLab Provider Updates

```bash
# In lib/providers/gitlab.sh
rca_issue_create() {
    [[ "$1" == "--repocli-can-handle" ]] && { echo "issue create"; return 0; }
    
    # ... existing code ...
    
    # Handle label parameters
    local labels=""
    while [[ $# -gt 0 ]]; do
        case "$1" in
            "--label")
                if [[ -n "$labels" ]]; then
                    labels="$labels,$2"
                else
                    labels="$2"
                fi
                shift 2
                ;;
            # ... other parameters ...
        esac
    done
    
    # Add to glab command
    [[ -n "$labels" ]] && glab_args+=(--label "$labels")
}

rca_issue_list() {
    [[ "$1" == "--repocli-can-handle" ]] && { echo "issue list"; return 0; }
    
    # ... existing code ...
    
    # Handle label filter
    local label_filter=""
    while [[ $# -gt 0 ]]; do
        case "$1" in
            "--label")
                label_filter="$2"
                shift 2
                ;;
            # ... other parameters ...
        esac
    done
    
    # Add to glab command  
    [[ -n "$label_filter" ]] && glab_args+=(--label "$label_filter")
}
```

### 2. JSON Output Normalization

```bash
# Function to normalize label format
normalize_gitlab_labels() {
    local output="$1"
    echo "$output" | jq '
        if type == "array" then
            map(.labels = (.labels // [] | map(
                if type == "string" then {"name": .} else . end
            )))
        else
            .labels = (.labels // [] | map(
                if type == "string" then {"name": .} else . end
            ))
        end
    '
}
```

### 3. GitHub Provider Documentation

```bash
# In lib/providers/github.sh (documentation only)
rca_issue_create() {
    [[ "$1" == "--repocli-can-handle" ]] && { echo "issue create"; return 0; }
    return 0  # Documentation only - actual execution via exec gh "$@"
    
    # DOCUMENTATION: Label parameter handling examples
    # --label bug,enhancement  (comma-separated)
    # --label bug --label enhancement  (multiple flags)
    # GitHub natively supports both formats
}

rca_issue_list() {
    [[ "$1" == "--repocli-can-handle" ]] && { echo "issue list"; return 0; }
    return 0  # Documentation only - actual execution via exec gh "$@"
    
    # DOCUMENTATION: Label filtering examples
    # --label bug  (single label filter)
    # Multiple --label flags for OR logic in GitHub
}
```

### 4. Cross-Testing Integration

```bash
# New test: tests/cross-testing/test-labels.sh
test_issue_create_with_labels() {
    local github_output github_labels
    local gitlab_output gitlab_labels
    
    # Test with multiple labels
    github_output=$(gh issue create --title "Label Test" --label bug,enhancement --json labels)
    gitlab_output=$(repocli issue create --title "Label Test" --label bug,enhancement --json labels)
    
    # Compare normalized outputs
    github_labels=$(echo "$github_output" | jq '.labels')
    gitlab_labels=$(echo "$gitlab_output" | normalize_gitlab_labels | jq '.labels')
    
    # Validate equivalence
    compare_json_semantically "$github_labels" "$gitlab_labels"
}
```

## Edge Cases to Handle

### 1. Special Characters in Labels
- Labels with spaces: `"needs review"`
- Unicode labels: `"üêõ bug"`  
- Special chars: `"high-priority!"`

### 2. Multiple Label Formats
- Comma-separated: `--label bug,enhancement`
- Multiple flags: `--label bug --label enhancement`
- Mixed usage in same command

### 3. Label Filtering Edge Cases
- Non-existent labels in filter
- Case sensitivity differences between providers
- Empty label results

## Dependencies
- [ ] Task 16: Wrapper fixes must be complete (proper option handling)
- [ ] Understanding of GitHub vs GitLab label APIs
- [ ] Access to test repositories for label testing

## Effort Estimate
- Size: M
- Hours: 8-12 hours
- Parallel: true (extends existing functionality)

## Definition of Done
- [ ] Issue creation with labels works correctly through REPOCLI
- [ ] Issue listing with label filter works correctly through REPOCLI
- [ ] GitLab provider properly translates label parameters in both operations
- [ ] JSON output consistently formatted across providers
- [ ] Cross-testing validates label functionality for issue operations only
- [ ] Edge cases handled gracefully (special chars, multiple formats)
- [ ] Documentation updated with label examples for issue operations only

‚ö†Ô∏è **EXCLUDED**: Standalone label management commands (create, list, delete labels) are NOT in scope.

## Usage Examples

```bash
# Create issue with labels (comma-separated)
repocli issue create --title "Bug report" --label bug,urgent --body "Description"

# Create issue with labels (multiple flags)
repocli issue create --title "Feature request" --label enhancement --label priority-high

# List issues by single label
repocli issue list --label bug

# List issues with multiple label filters (OR logic)
repocli issue list --label bug --label urgent

# JSON output with labels included
repocli issue list --json labels,title,number

# Cross-testing validation for labels
./tests/cross-testing/run-cross-tests.sh labels
```

## Testing Strategy

1. **Unit Tests**: Issue creation and listing with labels
2. **Integration Tests**: Full issue workflow with label filtering
3. **Cross-Provider Tests**: GitHub vs GitLab equivalence for issue operations only  
4. **Edge Case Tests**: Special characters, multiple label formats
5. **JSON Output Tests**: Consistent label format across providers

This task focuses specifically on enhancing REPOCLI's issue management capabilities with essential label support, avoiding unnecessary complexity of standalone label management.