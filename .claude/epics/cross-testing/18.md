---
name: Add support for parent/child issue relationships
status: open
created: 2025-08-25T14:10:00Z
updated: 
last_sync: 2025-08-25T14:14:47Z
github: https://github.com/quazardous/repocli/issues/20 
depends_on: [16]
parallel: true
conflicts_with: []
priority: normal
type: feature
---

# Task: Add support for parent/child issue relationships

## Description
Implement support for hierarchical issue relationships in REPOCLI with proper translation between GitHub and GitLab's different approaches to issue linking. This includes handling tasklists, issue references, and blocking relationships.

## Problem Analysis

**GitHub vs GitLab Issue Relationship Differences:**

| Aspect | GitHub | GitLab |
|--------|--------|--------|
| **Native Support** | Limited (tasklists, references) | Full (related issues, blocking) |
| **Syntax** | `- [ ] #123` (tasklist), `Closes #123` | `Related to #123`, `Blocks #123` |
| **API Fields** | No direct parent/child API | `_links.related_issues` |
| **Blocking** | Manual in description | Native `blocks`/`blocked_by` |
| **Hierarchy** | Flat with references | True parent/child support |
| **Cross-references** | Auto-detected in description | Explicit relationship types |

## GitHub Approach (Workarounds)
GitHub doesn't have native parent/child relationships, but uses:
1. **Tasklists**: `- [ ] Fix #123` in issue description
2. **References**: `Related to #456` in description
3. **Keywords**: `Closes #789`, `Fixes #101` (for PR linking)
4. **Projects**: Kanban boards for grouping (not parent/child)

## GitLab Approach (Native)
GitLab has comprehensive issue relationships:
1. **Related issues**: `glab issue create --related #123`
2. **Blocking relationships**: `glab issue create --blocks #123`
3. **Child issues**: True hierarchical support
4. **Subtasks**: Native issue hierarchy

## Acceptance Criteria

### Core Functionality
- [ ] Create issues with parent relationship: `repocli issue create --parent #123`
- [ ] Create issues with child references: `repocli issue create --child #456`
- [ ] List issue hierarchy: `repocli issue children #123`, `repocli issue parent #456`
- [ ] Blocking relationships: `repocli issue create --blocks #789`
- [ ] Related issues: `repocli issue create --related #101`

### Parameter Translation
- [ ] **GitHub → GitLab**: Convert description-based relationships to native GitLab relationships
- [ ] **GitLab → GitHub**: Convert native relationships to structured description text
- [ ] Handle mixed relationship types appropriately
- [ ] Preserve relationship semantics across providers

### JSON Output Consistency
- [ ] Standardize relationship output format across providers
- [ ] Include relationship metadata in JSON responses
- [ ] Handle bidirectional relationships correctly

## Implementation Strategy

### 1. Universal Relationship Commands

```bash
# New REPOCLI relationship commands
repocli issue create --title "Child task" --parent #123 --body "Description"
repocli issue create --title "Blocking issue" --blocks #456 --body "Description" 
repocli issue create --title "Related work" --related #789 --body "Description"

# Querying relationships  
repocli issue children #123    # List child issues
repocli issue parent #456      # Show parent issue
repocli issue related #789     # Show related issues
repocli issue blocking #101    # Show blocked issues
repocli issue blocked-by #102  # Show blocking issues
```

### 2. Provider-Specific Translation

**GitLab Provider (Native Support):**
```bash
# Direct mapping to GitLab CLI
--parent #123    → glab issue create --related #123 (with parent note)
--child #456     → glab issue create + update parent with child reference
--blocks #789    → glab issue create --blocks #789  
--related #101   → glab issue create --related #101
```

**GitHub Provider (Description-Based):**
```bash
# Convert to structured description format
--parent #123    → Add "Parent: #123" to description
--child #456     → Add child reference to parent issue description
--blocks #789    → Add "Blocks: #789" to description
--related #101   → Add "Related to: #101" to description
```

### 3. Description Format Standardization

**GitHub Description Template:**
```markdown
<!-- REPOCLI Relationships -->
Parent: #123
Children: #456, #457
Blocks: #789
Blocked by: #790
Related: #101, #102
<!-- End Relationships -->

[User description content...]
```

**Parsing Strategy:**
```bash
# Extract relationships from GitHub issues
parse_github_relationships() {
    local description="$1"
    echo "$description" | sed -n '/<!-- REPOCLI Relationships -->/,/<!-- End Relationships -->/p' \
        | grep -E "(Parent|Children|Blocks|Blocked by|Related):" \
        | sed 's/#\([0-9]\+\)/\1/g'
}
```

## Technical Implementation

### 1. New Provider Functions

```bash
# In lib/providers/gitlab.sh
gitlab_issue_create_with_relationships() {
    local title="$1" body="$2"
    local parent="" children=() blocks=() related=()
    
    # Parse relationship parameters
    while [[ $# -gt 0 ]]; do
        case "$1" in
            "--parent") parent="$2"; shift 2 ;;
            "--child") children+=("$2"); shift 2 ;;
            "--blocks") blocks+=("$2"); shift 2 ;;
            "--related") related+=("$2"); shift 2 ;;
            *) shift ;;
        esac
    done
    
    # Create base issue
    local issue_url=$(glab issue create --title "$title" --description "$body")
    local issue_num=$(echo "$issue_url" | grep -oE '[0-9]+$')
    
    # Add relationships
    [[ -n "$parent" ]] && glab issue update "$issue_num" --add-related "$parent"
    for child in "${children[@]}"; do
        glab issue update "$child" --add-related "$issue_num"
    done
    for block in "${blocks[@]}"; do
        # GitLab specific blocking relationship
        glab api projects/$PROJECT_ID/issues/$issue_num/links -X POST -d issue_id=$block -d link_type=blocks
    done
    
    echo "$issue_url"
}

gitlab_issue_children() {
    local issue_num="$1"
    glab api projects/$PROJECT_ID/issues/$issue_num/links | jq -r '.[] | select(.link_type=="relates_to") | .target_issue.iid'
}
```

### 2. GitHub Provider (Description-Based)

```bash
# In lib/providers/github.sh  
github_issue_create_with_relationships() {
    local title="$1" body="$2"
    local relationships=""
    
    # Build relationship section
    [[ -n "$parent" ]] && relationships+="\nParent: #$parent"
    [[ ${#children[@]} -gt 0 ]] && relationships+="\nChildren: $(IFS=,; echo "#${children[*]}")"
    [[ ${#blocks[@]} -gt 0 ]] && relationships+="\nBlocks: $(IFS=,; echo "#${blocks[*]}")"
    
    # Combine with user description
    local full_body="<!-- REPOCLI Relationships -->$relationships\n<!-- End Relationships -->\n\n$body"
    
    gh issue create --title "$title" --body "$full_body"
}

github_issue_children() {
    local issue_num="$1"
    local description=$(gh issue view "$issue_num" --json body -q '.body')
    parse_github_relationships "$description" | grep "Children:" | cut -d: -f2 | tr ',' '\n' | xargs
}
```

### 3. Cross-Provider Relationship Queries

```bash
# Universal relationship commands
repocli_issue_children() {
    case "$REPOCLI_PROVIDER" in
        "gitlab") gitlab_issue_children "$1" ;;
        "github") github_issue_children "$1" ;;
        *) echo "Provider $REPOCLI_PROVIDER not supported" >&2; return 1 ;;
    esac
}

repocli_issue_parent() {
    case "$REPOCLI_PROVIDER" in
        "gitlab") gitlab_issue_parent "$1" ;;
        "github") github_issue_parent "$1" ;;
        *) echo "Provider $REPOCLI_PROVIDER not supported" >&2; return 1 ;;
    esac
}
```

## Advanced Features

### 1. Relationship Visualization
```bash
# ASCII tree view of issue hierarchy
repocli issue tree #123
# Output:
# Issue #123: Main Feature
# ├── Issue #124: Backend API
# │   ├── Issue #125: Database Schema
# │   └── Issue #126: API Endpoints
# └── Issue #127: Frontend UI
#     ├── Issue #128: Components
#     └── Issue #129: Routing
```

### 2. Bulk Relationship Operations
```bash
# Create multiple child issues
repocli issue create-children #123 \
    --child "Backend work" \
    --child "Frontend work" \
    --child "Testing work"

# Link existing issues as children
repocli issue link-children #123 #124 #125 #126
```

### 3. Relationship Migration
```bash
# Migrate GitHub description-based relationships to native GitLab
repocli issue migrate-relationships --from github --to gitlab --repo user/project
```

## Cross-Testing Integration

### 1. Relationship Equivalence Tests
```bash
# Test parent/child creation
test_parent_child_relationships() {
    # Create parent issue
    local parent_github=$(gh issue create --title "Parent Task")
    local parent_gitlab=$(repocli issue create --title "Parent Task")
    
    # Create child issues
    local child_github=$(gh issue create --title "Child" --body "Parent: $parent_github")
    local child_gitlab=$(repocli issue create --title "Child" --parent "$parent_gitlab")
    
    # Validate relationships
    assert_relationship_exists "$parent_github" "$child_github" "child"
    assert_relationship_exists "$parent_gitlab" "$child_gitlab" "child"
}
```

### 2. JSON Output Comparison
```bash
# Standardized relationship JSON format
{
  "number": 123,
  "title": "Main Issue",
  "relationships": {
    "parent": null,
    "children": [124, 125],
    "blocks": [126],
    "blocked_by": [],
    "related": [127, 128]
  }
}
```

## Dependencies
- [ ] Task 16: Wrapper option handling fixes
- [ ] Understanding of GitLab relationship APIs  
- [ ] Understanding of GitHub issue reference parsing
- [ ] Access to test repositories for relationship testing

## Effort Estimate
- Size: L
- Hours: 16-24 hours
- Parallel: true (extends existing functionality)

## Definition of Done
- [ ] All relationship operations work correctly through REPOCLI
- [ ] GitLab provider uses native relationship features
- [ ] GitHub provider uses structured description format
- [ ] Relationship queries return consistent results across providers
- [ ] Cross-testing validates relationship functionality
- [ ] JSON output standardized for relationships
- [ ] Documentation includes relationship examples

## Usage Examples

```bash
# Create issue with relationships
repocli issue create --title "Main Feature" \
    --parent #100 \
    --child #102 \
    --blocks #103 \
    --related #104 \
    --body "Feature description"

# Query relationships
repocli issue children #123
repocli issue parent #456
repocli issue tree #123

# Cross-provider testing
./tests/cross-testing/run-cross-tests.sh relationships
```

This task adds significant project management capabilities to REPOCLI by bridging the gap between GitHub's simple referencing and GitLab's comprehensive relationship system.