---
last_sync: 2025-08-25T23:03:33+02:00
name: Implement GitHub Provider Tests
status: completed
created: 2025-08-25T09:00:28Z
updated: 
github: https://github.com/quazardous/repocli/issues/5
depends_on: [3, 4]
parallel: true
conflicts_with: []
---

# Task: Implement GitHub Provider Tests

## Description
Create minimal "ping check" validation tests for GitHub provider since it's a lightweight 1:1 passthrough wrapper to `gh` CLI. This is essentially a connectivity and transparency test to verify that the wrapper doesn't break the underlying `gh` functionality.

**ðŸ“ PING CHECK NATURE**: These are basic "does it work?" tests, not comprehensive functionality testing.

âš ï¸ **READ-ONLY TESTING**: All GitHub tests MUST use read-only operations on public repositories. No authentication or user account access required.

âš ï¸ **LIGHTWEIGHT APPROACH**: Since GitHub provider is just `exec gh "$@"`, we only need to verify the wrapper doesn't interfere with basic operations.

## Acceptance Criteria (PING CHECK TESTS)
- [x] âœ… **Basic wrapper ping**: `repocli --version` returns GitHub CLI version - `test_github_version_passthrough()` implemented
- [x] âœ… **Auth status ping**: `repocli auth status` works (even if not authenticated) - `test_github_auth_status()` implemented
- [x] âœ… **Public repo ping**: `repocli issue list --repo microsoft/vscode --limit 1` - `test_github_public_repo_access()` implemented
- [x] âœ… **JSON output ping**: Verify `--json` flag works through wrapper - `test_github_json_output()` implemented
- [x] âœ… **Error passthrough ping**: Invalid commands show proper `gh` error messages with consistent exit codes - `test_github_error_handling()` implemented
- [x] âœ… **PM compatibility ping**: Error detection patterns match PM system expectations - Integrated with task #22 patterns
- [x] âœ… **Speed requirement**: Test execution under 5 seconds total (lightweight ping nature) - `test_github_speed_requirement()` implemented
- [x] âœ… **Code reuse compliance**: Duplicate debug_log function removed, uses test-config.sh utilities

## Technical Details
- **Implementation approach**: Lightweight ping checks - verify wrapper transparency is not broken
- **Key considerations**: Ultra-minimal testing since GitHub is pure passthrough (`exec gh "$@"`) + PM compatibility
- **Ping check focus**: Does the wrapper break anything? Are error codes preserved? Do PM patterns work?
- **Code locations/files affected**:
  - `tests/cross-testing/lib/github-tests.sh` (new ping check functions)
  - **`lib/providers/github.sh`**: Already contains PM system error handling documentation (Task #22)
  - Basic GitHub provider configuration test

## Implementation Strategy

### Code Reuse Requirements
- **AVOID DUPLICATION**: Do not duplicate utility functions like `debug_log` unless they are very simple (one-line functions)
- **USE EXISTING UTILITIES**: Source and reuse functions from `tests/cross-testing/lib/test-config.sh` and `tests/cross-testing/lib/test-utils.sh`
- **MINIMIZE CODE**: Keep implementation minimal - this is a ping check, not comprehensive testing

### GitHub Provider Ping Check Suite
```bash
# tests/cross-testing/lib/github-tests.sh
# Source existing utilities - DO NOT DUPLICATE
source "$(dirname "${BASH_SOURCE[0]}")/test-config.sh"
source "$(dirname "${BASH_SOURCE[0]}")/test-utils.sh"

# PM Error Handling Analysis Results:
# - PM uses: if gh auth status &> /dev/null; then
# - PM uses: echo "$(gh auth status 2>&1 | grep -o 'Logged in to [^ ]*' || echo 'Not authenticated')"
# - PM uses: if command -v gh &> /dev/null; then
# - PM uses: exit 1 for hard failures, exit 0 for graceful completions
# - PM expects consistent exit codes and error messages

test_github_wrapper_basic() {
    echo "Testing GitHub wrapper basic functionality..."
    
    # Test 1: Version passthrough
    local version_output=$(repocli --version 2>&1)
    local version_exit_code=$?
    if [[ $version_exit_code -eq 0 ]] && echo "$version_output" | grep -q "gh version"; then
        echo "âœ… Version command passthrough working (exit code: $version_exit_code)"
    else
        echo "âŒ Version command failed: $version_output (exit code: $version_exit_code)"
        return 1
    fi
    
    # Test 2: Auth status (PM-compatible pattern testing)
    local auth_output=$(repocli auth status 2>&1)
    local auth_exit_code=$?
    # Test PM's expected pattern: should work with &> /dev/null redirection
    if repocli auth status &> /dev/null; then
        echo "âœ… Auth status (authenticated): PM pattern compatible"
    else
        echo "âœ… Auth status (not authenticated): PM pattern compatible"
    fi
    
    # Test 3: Public repo access
    local issue_output=$(repocli issue list --repo microsoft/vscode --limit 1 --json number 2>&1)
    local issue_exit_code=$?
    if [[ $issue_exit_code -eq 0 ]] && echo "$issue_output" | grep -q -E '\[.*\]|\[\]'; then
        echo "âœ… Public repository access working (exit code: $issue_exit_code)"
    else
        echo "âŒ Public repo access failed: $issue_output (exit code: $issue_exit_code)"
        return 1
    fi
    
    echo "ðŸŽ‰ GitHub wrapper hello world tests passed"
}

test_github_error_handling() {
    echo "Testing GitHub wrapper error handling consistency..."
    
    # Test 1: Invalid command - should maintain gh exit code
    local invalid_output=$(repocli invalid-command 2>&1)
    local invalid_exit_code=$?
    if [[ $invalid_exit_code -ne 0 ]]; then
        echo "âœ… Invalid command returns non-zero exit code ($invalid_exit_code)"
    else
        echo "âŒ Invalid command should return non-zero exit code"
        return 1
    fi
    
    # Test 2: Command availability check (PM pattern)
    if command -v repocli &> /dev/null; then
        echo "âœ… Command detection works (PM pattern compatible)"
    else
        echo "âŒ Command detection failed"
        return 1
    fi
    
    echo "âœ… Error handling consistency validated"
}

# That's it - GitHub provider needs minimal testing with PM compatibility
```

## Dependencies
- [ ] **Task #22**: PM system analysis for error patterns and PM compatibility requirements (BLOCKING)
- [ ] Task 3: Environment isolation utilities (for provider config)
- [ ] `gh` CLI tool installed and functional
- [ ] Internet connectivity to GitHub.com (for public repo test)

## GitHub Provider Documentation Requirements

**Must be added to `lib/providers/github.sh`:**

```bash
# ERROR HANDLING PATTERNS FOR PM SYSTEM COMPATIBILITY
#
# BASIC REQUIREMENTS (detailed analysis in Task #22):
# - Preserve exact exit codes from underlying CLI
# - Error messages must follow GitHub patterns for PM compatibility
# - Silent operations (&> /dev/null) must work identically across providers
# - Command detection (command -v) must work consistently
#
# WRAPPER IMPLEMENTATION:
# - GitHub provider: Uses exec gh "$@" for perfect transparency
# - Other providers: Must mimic GitHub error behavior (patterns defined in Task #22)
#
# DEBUG OUTPUT STRATEGY:
# - Raw provider output available via REPOCLI_DEBUG=1
# - Debug output goes to stderr (won't break PM stdout parsing)
# - Implementation details and error mapping patterns: See Task #22
```

## Effort Estimate
- Size: XS (trÃ¨s simple)
- Hours: 2-3 hours maximum
- Parallel: true (independent of other tests)

## PM System Error Handling Compatibility

**Key Requirements for Wrapper Error Consistency:**
- Exit codes must match `gh` CLI exactly (PM uses `if gh auth status &> /dev/null`)
- Error messages should be unchanged (PM parses specific patterns like "Logged in to")
- Command availability detection must work (`command -v repocli &> /dev/null`)
- Authentication status detection must be consistent with PM expectations
