---
last_sync: 2025-08-25T23:03:33+02:00
name: Implement rca_sub_issue_create wrapper function for PM compatibility
status: open
created: 2025-08-25T22:15:00Z
updated: 
github: https://github.com/quazardous/repocli/issues/31
depends_on: [22]
parallel: false
conflicts_with: []
---

# Task: Implement rca_sub_issue_create wrapper function for PM compatibility

## Description
Implement the single missing rca_ function identified in Task #22 PM system audit: `rca_sub_issue_create`. This function handles the `gh sub-issue create --parent N` command that PM system uses for creating child issues in epic workflows.

**üéØ PRIMARY FOCUS**: Complete PM system compatibility by implementing the only missing wrapper function.

‚ö†Ô∏è **CURRENT STATUS**: PM system audit (Task #22) identified this as the only missing function from 14 required rca_ functions for full PM compatibility.

## Acceptance Criteria
- [x] ‚úÖ **GitHub Provider Documentation**: Add `rca_sub_issue_create` pseudo function with PM usage examples - Completed in lib/providers/github.sh
- [ ] **GitLab Provider Implementation**: Implement `rca_sub_issue_create` with GitLab equivalent functionality  
- [ ] **Parameter Translation**: Handle `--parent`, `--title`, `--body-file`, `--label` parameters
- [ ] **GitLab Adaptation**: Create parent-child relationship using GitLab issue relationships or references
- [ ] **Error Handling**: Consistent error patterns matching PM system expectations
- [ ] **Testing**: Comprehensive test coverage for sub-issue creation functionality
- [ ] **PM Workflow Validation**: Test actual PM epic-sync command with GitLab provider
- [ ] **Documentation**: Usage examples and GitLab behavior differences documented

## Technical Details
- **Implementation approach**: GitHub pseudo documentation + GitLab provider implementation
- **Key considerations**: GitLab doesn't have exact sub-issue equivalent, use issue references and labels
- **Code locations/files affected**:
  - `lib/providers/github.sh` (add rca_sub_issue_create documentation)
  - `lib/providers/gitlab.sh` (implement rca_sub_issue_create functionality)
  - `tests/cross-testing/lib/gitlab-tests.sh` (add sub-issue testing)

## Implementation Requirements

### Primary Deliverable: `lib/providers/github.sh` Documentation

**üéØ KEY PRINCIPLE**: Document PM usage patterns for sub-issue creation with GitHub CLI extension.

```bash
# In lib/providers/github.sh - DOCUMENTATION
rca_sub_issue_create() {
    [[ "$1" == "--repocli-can-handle" ]] && { echo "sub-issue create"; return 0; }
    return 0  # Documentation only - actual execution via exec gh "$@"
    
    # DOCUMENTATION: Sub-issue creation for PM system (via extension)
    # Used by PM commands: /pm:epic-sync
    # 
    # GitHub CLI usage patterns (requires yahsan2/gh-sub-issue extension):
    # gh sub-issue create --parent 123 --title "Task name" --body-file /tmp/task.md
    # gh sub-issue create --parent 123 --title "Task" --label "epic-cross-testing"
    #
    # Parameter examples:
    # --parent 123            # Parent issue number (REQUIRED)
    # --title "task name"     # Child issue title (REQUIRED) 
    # --body-file path.md     # Child issue body from file
    # --label "label-name"    # Labels for child issue
    #
    # PM workflow integration:
    # - Epic sync: Creates child tasks under epic issue
    # - Task management: Maintains parent-child relationships
    # - Issue organization: Groups related tasks under epics
    #
    # Error detection: status only - PM checks exit code for success/failure
}
```

### GitLab Provider Implementation

```bash
# In lib/providers/gitlab.sh - ACTUAL implementation
rca_sub_issue_create() {
    [[ "$1" == "--repocli-can-handle" ]] && { echo "sub-issue create"; return 0; }
    
    local parent_issue="" title="" body_file="" labels=()
    
    # Parse sub-issue creation arguments
    while [[ $# -gt 0 ]]; do
        case "$1" in
            "--parent") parent_issue="$2"; shift 2 ;;
            "--title") title="$2"; shift 2 ;;
            "--body-file") body_file="$2"; shift 2 ;;
            "--label") labels+=("$2"); shift 2 ;;
            *) shift ;;
        esac
    done
    
    # Validate required parameters
    [[ -z "$parent_issue" ]] && { echo "Error: --parent required for sub-issue creation" >&2; return 1; }
    [[ -z "$title" ]] && { echo "Error: --title required for sub-issue creation" >&2; return 1; }
    
    # Create child issue with GitLab
    local glab_args=(--title "$title")
    
    # Add body if provided
    if [[ -n "$body_file" && -f "$body_file" ]]; then
        glab_args+=(--description-file "$body_file")
    fi
    
    # Add labels (include parent relationship)
    local all_labels=("${labels[@]}" "parent-issue-$parent_issue")
    for label in "${all_labels[@]}"; do
        glab_args+=(--label "$label")
    done
    
    # Create the issue and capture number
    local issue_output
    if issue_output=$(glab issue create "${glab_args[@]}" 2>&1); then
        local issue_number=$(echo "$issue_output" | grep -oE '#[0-9]+' | head -1 | sed 's/#//')
        
        # Add comment to parent issue referencing child
        if [[ -n "$issue_number" ]]; then
            local parent_comment="Child task created: #$issue_number - $title"
            glab issue note create "$parent_issue" --message "$parent_comment" >/dev/null 2>&1
            
            # Add comment to child issue referencing parent  
            local child_comment="Parent epic: #$parent_issue"
            glab issue note create "$issue_number" --message "$child_comment" >/dev/null 2>&1
        fi
        
        echo "$issue_output"
        return 0
    else
        echo "$issue_output" >&2
        return 1
    fi
}
```

## Testing Requirements

### Sub-Issue Creation Tests

```bash
# In tests/cross-testing/lib/gitlab-tests.sh
test_gitlab_sub_issue_creation() {
    echo "Testing GitLab sub-issue creation (PM compatibility)..."
    
    if [[ "$gitlab_test_mode" != "read_only" ]]; then
        # Create parent issue first
        local parent_output=$(repocli issue create --title "PM Test Epic" --body "Epic for sub-issue testing")
        local parent_number=$(echo "$parent_output" | grep -oE '#[0-9]+' | head -1 | sed 's/#//')
        
        if [[ -n "$parent_number" ]]; then
            # Test sub-issue creation
            local sub_output=$(repocli sub-issue create --parent "$parent_number" --title "PM Test Task" --label "test")
            local sub_exit_code=$?
            
            if [[ $sub_exit_code -eq 0 ]]; then
                echo "‚úÖ Sub-issue creation working (PM compatible)"
                
                # Verify parent-child relationship established
                local parent_comments=$(repocli issue view "$parent_number" --comments 2>/dev/null || true)
                if echo "$parent_comments" | grep -q "Child task created"; then
                    echo "‚úÖ Parent-child relationship established"
                else
                    echo "‚ö†Ô∏è Parent-child relationship not found in comments"
                fi
            else
                echo "‚ùå Sub-issue creation failed: $sub_output"
                return 1
            fi
        else
            echo "‚ö†Ô∏è Could not create parent issue for sub-issue test"
            return 1
        fi
    else
        echo "‚ö†Ô∏è Sub-issue creation test requires write access (skipped in read-only mode)"
    fi
}
```

## PM Workflow Integration Testing

```bash
# Test actual PM command with GitLab provider
test_pm_epic_sync_with_gitlab() {
    echo "üîß Testing PM epic-sync command with GitLab provider..."
    
    # This test validates the actual PM workflow using REPOCLI wrapper
    if [[ "$gitlab_test_mode" != "read_only" ]]; then
        # Set up GitLab provider configuration
        local temp_config=$(create_temp_config gitlab)
        export REPOCLI_CONFIG="$temp_config"
        
        # Test PM epic-sync (simplified version)
        # This would require actual PM command integration
        echo "‚úÖ PM epic-sync integration test framework ready"
        
        cleanup_test_config
    fi
}
```

## Dependencies
- [ ] Task 22: PM System Coverage Analysis (parent task - completed audit)
- [ ] Understanding of GitLab issue relationships and labeling system
- [ ] Test GitLab repository with create permissions for sub-issue testing
- [ ] `glab` CLI tool with issue creation capabilities

## Effort Estimate
- Size: S
- Hours: 4-6 hours
- Parallel: false (depends on Task #22 completion)

## Usage Examples

```bash
# Example 1: Basic sub-issue creation (PM pattern)
repocli sub-issue create --parent 123 --title "Implement feature X"

# Example 2: Sub-issue with body and labels (PM epic-sync pattern)  
repocli sub-issue create --parent 456 --title "Test coverage" --body-file /tmp/task.md --label "epic-cross-testing"

# Example 3: PM epic-sync workflow integration
/pm:epic-sync cross-testing  # Should work with GitLab provider after implementation
```

This task completes the PM compatibility identified in Task #22 audit, enabling full PM system functionality with GitLab provider.

## Status Management

**PRIMARY**: Manage task status via GitHub issue status field using the values defined in TASK-STANDARDS.md

**CURRENT**: Manual status updates in frontmatter and GitHub issue